function X = unstandardize(Xnorm,bias,scale)
% -------------------------------------------------------------------------
[N,D,M] = size(Xnorm);
% -------------------------------------------------------------------------
if M > 1
    XX = zeros(N*M,D);
    for m = 1:M
        XX(N*(m-1)+1:N*m,:) = Xnorm(:,:,m);
    end
    Xnorm = XX;
    NN = N;
    N = N*M;
end
% -------------------------------------------------------------------------
if ~isempty(scale)
    X = Xnorm .* repmat(scale,N,1);
    if ~isempty(bias)
        X = X + repmat(bias,N,1);
    end
% -------------------------------------------------------------------------
elseif ~isempty(bias)
    X = Xnorm + repmat(bias,N,1);
% -------------------------------------------------------------------------
else
    X = Xnorm;
end
% -------------------------------------------------------------------------
if M > 1
    XX = zeros(NN,D,M);
    for m = 1:M
        XX(:,:,m) = X(NN*(m-1)+1:NN*m,:);
    end
    X = XX;
end
% -------------------------------------------------------------------------
